# LLM评价指标

## 一、Perplexity（困惑度）

困惑度（Perplexity，PPL）是一种用来评价语言模型好坏的指标，它主要是根据每个词来估计一句话出现的概率，并用句子长度作normalize，然后用这个指标来衡量模型的好坏。其公式为：
$$
PP(S) = P(\omega_{1} \omega_{2}... \omega_{N})^{-\frac{1}{N}} \\
\qquad \qquad \qquad \quad = (\prod_{i=1}^{N} p(\omega_{i}|\omega_{1} \omega_{2} ... \omega_{i-i}))^{-\frac{1}{N}}
$$

关于上述公式的解释，可以利用一个实际的例子进行说明：

假设我们的测试文档中只有下面一句话：

“爱你一万年！”

那么，现在我们有两个LLM进行测试，每个LLM都通过Tokenizer，然后去预测这句话。在LLM生成预测结果的时候，我们会拿到形状为*[句子长度, 词表长度]* 的概率矩阵，假设分别为：

```python
# modelA
probs_modelA = [
    [0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.04], 
    [0.05, 0.30, 0.05, 0.40, 0.05, 0.10, 0.05], 
    [0.30, 0.05, 0.30, 0.20, 0.05, 0.05, 0.05], 
    [0.20, 0.10, 0.05, 0.50, 0.05, 0.05, 0.05], 
    [0.30, 0.30, 0.05, 0.05, 0.10, 0.15, 0.05], 
    [0.05, 0.05, 0.05, 0.15, 0.35, 0.30, 0.05]
]

# modelB
probs_modelB = [
    [0.16, 0.16, 0.16, 0.16, 0.16, 0.16, 0.04], 
    [0.05, 0.50, 0.05, 0.20, 0.05, 0.10, 0.05], 
    [0.30, 0.05, 0.40, 0.10, 0.05, 0.05, 0.05], 
    [0.10, 0.10, 0.05, 0.60, 0.05, 0.05, 0.05], 
    [0.40, 0.30, 0.05, 0.05, 0.10, 0.05, 0.05], 
    [0.05, 0.05, 0.05, 0.15, 0.40, 0.25, 0.05]
]
```

